import{y as E}from"./utils-wvIv1qJ9-6ba7c9bb.js";import"./Editor-d71c30b8.js";import"./index-e011716a.js";const S="xml,rss,atom,jsx,tsx".split(","),w="area,base,br,col,embed,hr,img,input,link,meta,source,track,wbr".split(","),v=a=>{let n=[],t=[],i,c,f=(l,o)=>{i=[],t.length=n.length=c=0,h(l,o,0)},h=(l,o,e)=>{for(let r=0,d=S.includes(o),u=l.length;r<u;){const s=l[r++],p=s.content,T=s.type,x=s.length;if(Array.isArray(p))if(T=="tag"){if(p[0].content){const g=a.value,m=p[0].length,y=g[e+1]=="/",b=g.slice(e+1+y,e+m),k=g[e+x-2]=="/"||!d&&w.includes(b);if(p[2]&&d&&h(p.slice(1,-1),o,e+m),!k)if(y)for(let L=i.length;L;)b==i[--L][1]&&(n[n[c]=i[L][0]]=c,i.length=L,L=0);else i.push([c,b]);t[c++]=[s,e,1+y,e+x,b,k]}}else{let g=s.alias||T;h(p,g.indexOf("language-")?o:g.slice(9),e)}e+=x}};return a.addListener("tokenize",l=>{f(l.tokens,l.language)}),f(a.tokens,a.options.language),a.extensions.matchTags={tags:t,pairs:n}},C=(a,n)=>{for(let t=0,i=n.length;t<i;t++)if(n[t][1]<=a&&n[t][3]>=a)return t},z=()=>({update(a){this.update=()=>{};let n,t;const{tags:i,pairs:c}=this.matcher=a.extensions.matchTags||v(a),f=l=>[n,t].forEach(o=>{o&&o.classList.toggle("active-tagname",!l)}),h=()=>{let[l,o]=a.getSelection(),e,r;if(l==o&&a.focused){let d=C(l,i),u=i[d];if(u&&u[4]){const s=E(a,".tag>.tag",-u[2],0),p=c[d];if(s&&p+1){const T=E(a,".tag>.tag",0,0,i[p][1]);[e,r]=[s,T].map(x=>{let g=x.childNodes,m=g[1];return(g[2]||m.data)&&(m=document.createElement("span"),m.append(...[].slice.call(g,1)),x.append(m)),m})}}}n!=e&&(f(!0),n=e,t=r,f())};a.addListener("selectionChange",h)}}),I=(a,n)=>({update(t){this.update=()=>{};let i,c;const{tags:f}=this.matcher=t.extensions.matchTags||v(t),h=e=>E(t,".tag>.punctuation",0,0,e),l=e=>[i,c].forEach(r=>{r&&r.classList.toggle(a,!e)}),o=()=>{let[e,r]=t.getSelection(),d,u;if(e==r&&t.focused){let s=f[C(e,f)];s&&(n||(r<s[1]+s[2]||r>s[1]+s[2]+s[4].length)&&h())&&(d=h(s[1]),u=h(s[3]-1))}(i!=d||c!=u)&&(l(!0),i=d,c=u,l())};t.addListener("selectionChange",o),t.textarea.addEventListener("focus",o),t.textarea.addEventListener("blur",o)}});export{v as createTagMatcher,I as highlightTagPunctuation,z as matchTags};
